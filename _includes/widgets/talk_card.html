<div class="row mt-3">
    <div class="col">
        <div class="card border-0 shadow-sm bg-white rounded-xl overflow-hidden">
            <div class="card-body p-4">
                <h5 class="mb-4 text-uppercase font-weight-bold text-sm tracking-widest text-primary-700">
                    Talks
                </h5>

                <div class="talks-scroll-container" style="max-height: 850px; overflow-y: auto; border-radius: 12px;">
                    <div class="row g-4">
                        {% assign sorted_talks = site.data.profile.talks | sort: 'date' | reverse %}
                        {% for talk in sorted_talks %}
                        <div class="col-md-12">
                            <div class="d-flex flex-column" style="line-height: 1.5; font-size: 0.92rem; word-break: break-word;">
                                <div class="text-primary-700 mb-2 font-weight-bold tracking-wider" style="letter-spacing: 1px; font-size: 0.85rem;">
                                    {{ talk.date | date: "%b. %d, %Y" }}
                                </div>

                                <div class="font-weight-bold text-gray-900 mb-3" style="font-size: 1.05rem;">
                                    {% assign name_parts = talk.name | split: '@' %}
                                    {{ name_parts[0] }}@
                                    {% assign event_parts = name_parts[1] | split: '[' %}
                                    {% assign event_name = event_parts[0] | strip %}
                                    {% assign url_parts = event_parts[1] | split: ']' %}
                                    {% assign event_url = url_parts[0] | strip %}
                                    {% assign rest_of_text = url_parts[1] %}

                                    {% if event_url contains '://' %}
                                    <a href="{{ event_url }}" class="text-primary-700 text-decoration-none hover:text-primary-800 hover:underline">
                                        {{ event_name }}
                                    </a>
                                    {% else %}
                                    {{ event_name }}
                                    {% endif %}
                                    {{ rest_of_text }}
                                </div>

                                {% assign has_video = talk.video != "none" and talk.video != empty %}
                                {% assign has_slides = talk.slides != "none" and talk.slides != empty %}

                                {% if has_video or has_slides %}
                                <div class="row g-4">
                                    {% if has_video and has_slides %}
                                        {% assign col_class = "col-md-6" %}
                                    {% else %}
                                        {% assign col_class = "col-md-12" %}
                                    {% endif %}

                                    {% if has_video %}
                                    <div class="{{ col_class }}">
                                        <div class="position-relative overflow-hidden rounded-lg border-0 shadow-none bg-black">
                                            <div class="relative" style="height: 300px;">
                                                {% if talk.video contains 'bilibili.com' %}
                                                    {% assign video_parts = talk.video | split: '?' %}
                                                    {% assign base_url = video_parts[0] %}
                                                    {% assign params = video_parts[1] %}
                                                    {% assign bvid = base_url | split: '/video/BV' | last %}
                                                    <iframe class="w-100 h-100"
                                                            src="https://player.bilibili.com/player.html?bvid=BV{{ bvid }}{% if params %}&{{ params }}{% endif %}&page=1&as_wide=1&high_quality=1&danmaku=0"
                                                            allowfullscreen
                                                            sandbox="allow-same-origin allow-scripts allow-popups"
                                                            style="border: 0;"
                                                            loading="lazy"></iframe>
                                                {% elsif talk.video contains 'youtube.com' or talk.video contains 'youtu.be' %}
                                                    {% comment %}
                                                        Final YouTube fix:
                                                        1. Remove text-uppercase class from date element for proper capitalization
                                                        2. Fix YouTube URL generation (remove extra spaces)
                                                        3. Add proper error handling for missing video IDs
                                                    {% endcomment %}
                                                    {% assign video_id = "" %}
                                                    {% assign start_time = "" %}

                                                    {% comment %} Extract video ID {% endcomment %}
                                                    {% if talk.video contains 'youtu.be/' %}
                                                        {% assign video_id = talk.video | split: 'youtu.be/' | last | split: '?' | first | split: '&' | first %}
                                                    {% elsif talk.video contains 'v=' %}
                                                        {% assign video_id = talk.video | split: 'v=' | last | split: '&' | first | split: '#' | first %}
                                                    {% endif %}

                                                    {% comment %} Extract timestamp parameter {% endcomment %}
                                                    {% if talk.video contains '?t=' %}
                                                        {% assign start_time = talk.video | split: '?t=' | last | split: '&' | first | replace: 's', '' %}
                                                    {% elsif talk.video contains '&t=' %}
                                                        {% assign start_time = talk.video | split: '&t=' | last | split: '&' | first | replace: 's', '' %}
                                                    {% endif %}

                                                    {% comment %} Build proper embed URL {% endcomment %}
                                                    {% if video_id != empty %}
                                                        {% assign youtube_src = "https://www.youtube.com/embed/" | append: video_id %}
                                                        {% if start_time != empty %}
                                                            {% assign youtube_src = youtube_src | append: "?start=" | append: start_time %}
                                                        {% else %}
                                                            {% assign youtube_src = youtube_src | append: "?rel=0&modestbranding=1" %}
                                                        {% endif %}

                                                        <iframe class="w-100 h-100"
                                                                src="{{ youtube_src }}"
                                                                title="Embedded YouTube Video"
                                                                frameborder="0"
                                                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                                                referrerpolicy="strict-origin-when-cross-origin"
                                                                allowfullscreen
                                                                style="border: 0;"
                                                                loading="lazy"></iframe>
                                                    {% else %}
                                                        <div class="d-flex align-items-center justify-content-center h-100 bg-dark text-white">
                                                            <div class="text-center">
                                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-2">
                                                                    <circle cx="12" cy="12" r="10"></circle>
                                                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                                                </svg>
                                                                <p class="mb-0">Video ID not found</p>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                {% else %}
                                                    <iframe class="w-100 h-100"
                                                            src="{{ talk.video }}"
                                                            allowfullscreen
                                                            style="border: 0;"
                                                            loading="lazy"></iframe>
                                                {% endif %}
                                            </div>
                                            <div class="position-absolute top-2 right-2 bg-black text-white text-xs px-2 py-1 rounded-full font-medium shadow-sm d-flex align-items-center">
                                                <svg class="me-1" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                                    <line x1="1" y1="5" x2="1" y2="19"></line>
                                                </svg>
                                                Video
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}

                                    {% if has_slides %}
                                    <div class="{{ col_class }}">
                                        <div class="position-relative overflow-hidden rounded-lg border-0 shadow-none bg-black">
                                            <div class="relative" style="height: 300px;">
                                                <iframe class="w-100 h-100"
                                                        src="{{ talk.slides | replace: '/edit?', '/preview?' }}"
                                                        allowfullscreen
                                                        sandbox="allow-same-origin allow-scripts allow-popups"
                                                        style="border: 0;"
                                                        loading="lazy"></iframe>
                                            </div>
                                            <div class="position-absolute top-2 right-2 bg-black text-white text-xs px-2 py-1 rounded-full font-medium shadow-sm d-flex align-items-center">
                                                <svg class="me-1" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path>
                                                </svg>
                                                Slides
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                            {% if forloop.last == false %}
                            <hr class="my-4 border-gray-200">
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <style>
                    .talks-scroll-container {
                        scrollbar-width: thin;
                        scrollbar-color: #cbd5e1 #f1f5f9;
                    }

                    .talks-scroll-container::-webkit-scrollbar {
                        width: 8px;
                    }

                    .talks-scroll-container::-webkit-scrollbar-track {
                        background: #f1f5f9;
                        border-radius: 4px;
                    }

                    .talks-scroll-container::-webkit-scrollbar-thumb {
                        background-color: #cbd5e1;
                        border-radius: 4px;
                    }

                    .talks-scroll-container::-webkit-scrollbar-thumb:hover {
                        background-color: #94a3b8;
                    }

                    /* Added subtle hover effect for better UX */
                    .card {
                        transition: transform 0.2s ease;
                    }

                    .card:hover {
                        transform: translateY(-2px);
                    }
                </style>
            </div>
        </div>
    </div>
</div>